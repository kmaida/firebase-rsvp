angular.module("myApp",["firebase","ngRoute","ngResource","ngSanitize","ngMessages","mediaCheck","ui.bootstrap"]),function(){"use strict";function e(e,t,n,r,o,a){function i(e){u.rsvps=[];for(var t=e,n=0;n<t.length;n++){var r=t[n];r.userId===u.user.uid&&u.rsvps.push(r)}u.rsvpsReady=!0}var u=this;u.data=n.data(),u.user=n.ref.getAuth(),u.logins=o.LOGINS;{var s=u.user.provider;u.user[s].cachedUserProfile}u.userName=u.user[s].displayName,u.userPicture=r.getUserPicture(u.user);var c=n.rsvps();c.$loaded().then(i);var l=t.search().view;u.tabs=[{name:"User Info",query:"user-info"},{name:"RSVPs",query:"rsvps"}],u.currentTab=l?l:"user-info",e.$on("$routeUpdate",function(e,t){u.currentTab=t.params.view||"user-info"}),u.getProfile=function(){function e(e){u.user=e,u.administrator=u.user.isAdmin,u.linkedAccounts=User.getLinkedAccounts(u.user,"account"),u.showAccount=!0,u.rsvps=u.user.rsvps}function t(e){u.errorGettingUser=!0}userData.getUser().then(e,t)}}angular.module("myApp").controller("AccountCtrl",e),e.$inject=["$scope","$location","Fire","Utils","OAUTH","$timeout"]}(),function(){"use strict";function e(e,t,n){function r(){o.showAdmin=o.user.uid===o.data.master}var o=this;o.user=n.ref.getAuth(),o.data=n.data(),o.data.$loaded().then(r);var a=t.search().view;o.tabs=[{name:"Events",query:"events"},{name:"Add Event",query:"add-event"}],o.currentTab=a?a:"events",e.$on("$routeUpdate",function(e,t){o.currentTab=t.params.view||"events"}),o.showGuests=function(e,t){o.showGuestsEventId=e,o.showGuestsEventName=t,o.showModal=!0}}angular.module("myApp").controller("AdminCtrl",e),e.$inject=["$scope","$location","Fire"]}(),function(){"use strict";function e(e,t,n,r){var o=this;o.evtUrl=t.protocol()+"://"+t.host()+"/event/",o.blurUrlInput=function(){o.copyInput=null},o.showUrlInput=function(e){o.copyInput=e,n(function(){angular.element("#e"+e).find("input").select()})},o.events=e.events(),o.sortStartDate=function(e){return r.getJSDatetime(e.startDate,e.startTime)}}angular.module("myApp").controller("AdminEventListCtrl",e),e.$inject=["Fire","$location","$timeout","Event"]}(),function(){"use strict";function e(e,t,n,r){function o(e){s.editEvent=l.$getRecord(c),s.showEditForm=!0}function a(){s.btnDelete=!1,s.btnDeleteText="Delete Event"}function i(){s.btnDeleteText="Deleted!",s.btnDelete=!0,s.editEvent={},r(function(){n.path("/admin")},1500)}function u(){s.btnDeleteText="Error deleting!",r(a,3e3)}var s=this,c=t.eventId,l=e.events();s.tabs=["Update Details","Delete Event"],s.currentTab=0,s.changeTab=function(e){s.currentTab=e},s.user=e.ref.getAuth(),s.data=e.data(),l.$loaded(o),a(),s.deleteEvent=function(){function t(){angular.forEach(n,function(e){e.eventId===s.editEvent.$id&&n.$remove(e)})}var n=e.rsvps();s.btnDeleteText="Deleting...",n.$loaded().then(t),l.$remove(s.editEvent).then(i,u)}}angular.module("myApp").controller("EditEventCtrl",e),e.$inject=["Fire","$routeParams","$location","$timeout"]}(),function(){"use strict";function e(e,t,n,r,o){function a(a){function i(e){return r("date")(e,"MM/dd/yyyy")}function u(){d.btnSaved=!1,d.btnSubmitText=f?"Submit":"Update"}function s(){n.search("view","events")}function c(e){d.btnSaved=!0,d.btnSubmitText=f?"Saved!":"Updated!",f&&(d.showRedirectMsg=!0,t(s,2500)),m&&(d.showUpdateDetailLink=!0,t(u,2500))}function l(e){d.btnSaved="error",d.btnSubmitText=f?"Error saving!":"Error updating!",console.log(d.btnSubmitText,e),t(u,3e3)}var d=this,f=!!d.prefillModelId==!1,m=!!d.prefillModelId==!0,v=e.events();d.timeRegex=/^(0?[1-9]|1[012])(:[0-5]\d) [APap][mM]$/i,m&&v.$loaded().then(function(){d.formModel=v.$getRecord(d.prefillModelId)}),d.minDate=new Date,d.dateOptions={showWeeks:!1},d.startDateOpen=!1,d.endDateOpen=!1,d.toggleDatepicker=function(e,t){e.preventDefault(),e.stopPropagation(),d[t+"Open"]=!d[t+"Open"]},d.startDateBlur=function(){d.formModel&&d.formModel.startDate&&!d.formModel.endDate&&(d.formModel.endDate=i(d.formModel.startDate))},u(),d.validateDaterange=function(){if(d.formModel&&d.formModel.startDate&&d.formModel.startTime&&d.formModel.endDate&&d.formModel.endTime){var e=o.getJSDatetime(d.formModel.startDate,d.formModel.startTime),t=o.getJSDatetime(d.formModel.endDate,d.formModel.endTime);d.validDaterange=0>e-t}},d.submitEvent=function(){function t(){angular.forEach(n,function(e){e.eventId===d.formModel.$id&&e.eventName!==d.formModel.title&&(e.eventName=d.formModel.title,n.$save(e))})}if(d.formModel.startDate=i(d.formModel.startDate),d.formModel.endDate=i(d.formModel.endDate),f)v.$add(d.formModel).then(c,l);else if(m){var n=e.rsvps();n.$loaded().then(t),v.$save(d.formModel).then(c,l)}}}return a.$inject=["$scope"],{restrict:"EA",scope:{prefillModelId:"@"},templateUrl:"/ng-app/admin/eventForm.tpl.html",controller:a,controllerAs:"ef",bindToController:!0}}angular.module("myApp").directive("eventForm",e),e.$inject=["Fire","$timeout","$location","$filter","Event"]}(),function(){"use strict";function e(){function e(e,t,n,r){var o=new Date,a=o.setDate(o.getDate()-1);r.$parsers.unshift(function(e){var t=Date.parse(e),n=0>a-t;return r.$setValidity("pastDate",n),n?e:void 0}),r.$formatters.unshift(function(e){var t=Date.parse(e),n=0>a-t;return r.$setValidity("pastDate",n),e})}return e.$inject=["$scope","$elem","$attrs","ngModel"],{restrict:"A",require:"ngModel",link:e}}angular.module("myApp").directive("validateDateFuture",e),e.$inject=["eventData","$timeout","$location","$filter","Event"]}(),function(){"use strict";function e(e){function t(t){function n(e){function n(e){var t=0;r.guests=e;for(var n=0;n<r.guests.length;n++){var o=r.guests[n];o.attending&&(t+=o.guests)}r.totalGuests=t,r.guestsReady=!0}var o=e;t.$watch("g.eventId",function(e,t){if(e){var a=[];r.guestsReady=!1;for(var i=0;i<o.length;i++){var u=o[i];u.eventId===r.eventId&&a.push(u)}n(a)}})}var r=this,o=e.rsvps();o.$loaded().then(n),r.closeModal=function(){r.showModal=!1}}return t.$inject=["$scope"],{restrict:"EA",scope:{eventId:"=",eventName:"=",showModal:"="},templateUrl:"/ng-app/admin/viewEventGuests.tpl.html",controller:t,controllerAs:"g",bindToController:!0}}angular.module("myApp").directive("viewEventGuests",e),e.$inject=["Fire"]}(),function(){"use strict";function e(e,t){function n(e){var n,r=e.startDate,o=new Date(r),a=e.startTime,i=e.endDate,u=new Date(i),s=e.endTime,c="MMM d yyyy",l=t("date")(o,c),d=t("date")(u,c);return n=l===d?l+", "+a+" - "+s:l+", "+a+" - "+d+", "+s}function r(e,t){var n,r=new Date(e),o=t.split(" "),a=o[0].split(":"),i=1*a[0],u=1*a[1],s=o[1];return"PM"==s&&12!==i&&(i+=12),n=new Date(r.getFullYear(),r.getMonth(),r.getDate(),i,u)}function o(e){var t=r(e.endDate,e.endTime),n=new Date;return n>t}return{getPrettyDatetime:n,getJSDatetime:r,expired:o}}angular.module("myApp").factory("Event",e),e.$inject=["Utils","$filter"]}(),function(){"use strict";function e(e,t,n){function r(){return e(s)}function o(){var e=new Firebase(u+"data");return t(e)}function a(){var e=new Firebase(u+"events");return n(e)}function i(){var e=new Firebase(u+"rsvps");return n(e)}var u="https://intense-heat-5822.firebaseio.com/",s=new Firebase(u);return{uri:u,ref:s,auth:r,data:o,events:a,rsvps:i}}angular.module("myApp").factory("Fire",e),e.$inject=["$firebaseAuth","$firebaseObject","$firebaseArray"]}(),function(){"use strict";angular.module("myApp").constant("MQ",{SMALL:"(max-width: 767px)",LARGE:"(min-width: 768px)"})}(),function(){"use strict";angular.module("myApp").constant("OAUTH",{LOGINS:[{account:"google",name:"Google",url:"http://accounts.google.com"},{account:"twitter",name:"Twitter",url:"http://twitter.com"},{account:"facebook",name:"Facebook",url:"http://facebook.com"},{account:"github",name:"GitHub",url:"http://github.com"}]})}(),function(){"use strict";function e(){function e(e){var t=e.provider,n=e[t].cachedUserProfile;return"github"===t?n.avatar_url:"google"===t?n.picture:"twitter"===t?n.profile_image_url:"facebook"===t?n.picture.data.url:void 0}function t(e){var t=["th","st","nd","rd"],n=e%100;return t[(n-20)%10]||t[n]||t[0]}return{getUserPicture:e,getOrdinal:t}}angular.module("myApp").factory("Utils",e)}(),function(){"use strict";function e(e,t,n){e.$on("$routeChangeStart",function(r,o,a){var i=n.ref.getAuth();o&&o.$$route&&o.$$route.secure&&!i&&(e.authPath=t.path(),e.$evalAsync(function(){t.path("/login")}))})}angular.module("myApp").run(e),e.$inject=["$rootScope","$location","Fire"]}(),function(){"use strict";function e(e,t){e.when("/",{templateUrl:"ng-app/events/Events.view.html",secure:!0}).when("/login",{templateUrl:"ng-app/login/Login.view.html"}).when("/event/:eventId",{templateUrl:"ng-app/event-detail/EventDetail.view.html",secure:!0}).when("/event/:eventId/edit",{templateUrl:"ng-app/admin/EditEvent.view.html",secure:!0}).when("/account",{templateUrl:"ng-app/account/Account.view.html",secure:!0,reloadOnSearch:!1}).when("/admin",{templateUrl:"ng-app/admin/Admin.view.html",secure:!0,reloadOnSearch:!1}).otherwise({redirectTo:"/"}),t.html5Mode({enabled:!0}).hashPrefix("!")}angular.module("myApp").config(e),e.$inject=["$routeProvider","$locationProvider"]}(),function(){function e(e,t){function n(n,r,o){function a(){var e=r.find(".ad-test");n.ab.blocked=e.height()<=0||!r.find(".ad-test:visible").length}n.ab={},n.ab.host=t.host(),e(a,200)}return n.$inject=["$scope","$elem","$attrs"],{restrict:"EA",link:n,template:'<div class="ad-test fa-facebook fa-twitter" style="height:1px;"></div><div ng-if="ab.blocked" class="ab-message alert alert-danger"><i class="fa fa-ban"></i> <strong>AdBlock</strong> is prohibiting important functionality! Please disable ad blocking on <strong>{{ab.host}}</strong>. This site is ad-free.</div>'}}angular.module("myApp").directive("detectAdblock",e),e.$inject=["$timeout","$location"]}(),function(){"use strict";function e(e){if("object"==typeof e.data)return e.data;throw new Error("retrieved data is not typeof object.")}function t(t){this.getJSON=function(){return t.get("/ng-app/data/data.json").then(e)}}angular.module("myApp").service("localData",t),t.$inject=["$http"]}(),function(){"use strict";var e=angular.module("mediaCheck",[]);e.service("mediaCheck",["$window","$timeout",function(e,t){this.init=function(n){var r,o,a,i,u=n.scope,s=n.mq,c=n.debounce,l=angular.element(e),d=void 0,f=void 0!==e.matchMedia&&!!e.matchMedia("!").addListener,m=void 0,v=void 0,p=c?c:250;if(f)return v=function(e){e.matches&&"function"==typeof n.enter?n.enter(e):"function"==typeof n.exit&&n.exit(e),"function"==typeof n.change&&n.change(e)},(d=function(){return m=e.matchMedia(s),o=function(){return v(m)},m.addListener(o),l.bind("orientationchange",o),u.$on("$destroy",function(){m.removeListener(o),l.unbind("orientationchange",o)}),v(m)})();r={},v=function(e){return e.matches?!!r[s]==!1&&"function"==typeof n.enter&&n.enter(e):(r[s]===!0||null==r[s])&&"function"==typeof n.exit&&n.exit(e),(e.matches&&!r[s]||!e.matches&&(r[s]===!0||null==r[s]))&&"function"==typeof n.change&&n.change(e),r[s]=e.matches};var g=function(e){var t=document.createElement("div");return t.style.width="1em",t.style.position="absolute",document.body.appendChild(t),px=e*t.offsetWidth,document.body.removeChild(t),px},h=function(e,t){var n;switch(n=void 0,t){case"em":n=g(e);break;default:n=e}return n};r[s]=null,a=function(){var t=s.match(/\((.*)-.*:\s*([\d\.]*)(.*)\)/),n=t[1],r=h(parseInt(t[2],10),t[3]),o={},a=e.innerWidth||document.documentElement.clientWidth;return o.matches="max"===n&&r>a||"min"===n&&a>r,v(o)};var $=function(){clearTimeout(i),i=t(a,p)};return l.bind("resize",$),u.$on("$destroy",function(){l.unbind("resize",$)}),a()}}])}(),function(){"use strict";function e(e){return function(t){return e.trustAsHtml(t)}}angular.module("myApp").filter("trustAsHTML",e),e.$inject=["$sce"]}(),function(){"use strict";function e(e,t,n){function r(r){function o(){n(function(){r.vs.viewformat="small"})}function a(){n(function(){r.vs.viewformat="large"})}r.vs={},e.init({scope:r,mq:t.SMALL,enter:o,exit:a})}return r.$inject=["$scope"],{restrict:"EA",link:r}}angular.module("myApp").directive("viewSwitch",e),e.$inject=["mediaCheck","MQ","$timeout"]}(),function(){"use strict";function e(e,t,n,r,o){function a(){function e(){for(var e=0;e<t.length;e++){var n=t[e];if(n.eventId===c&&n.userId===s.user.uid){s.rsvpObj=n;break}}s.noRsvp=!s.rsvpObj;var r=s.noRsvp?null:s.rsvpObj.guests;!s.noRsvp&&!!r==!1||1==r?s.guestText=s.rsvpObj.name+" is":r&&r>1&&(s.guestText=s.rsvpObj.name+" + "+(r-1)+" are "),s.attendingText=!s.noRsvp&&s.rsvpObj.attending?"attending":"not attending",s.rsvpBtnText=s.noRsvp?"RSVP":"Update my RSVP",s.showEventDownload=s.rsvpObj&&s.rsvpObj.attending,s.createOrUpdate=s.noRsvp?"create":"update",s.rsvpReady=!0}var t=r.rsvps();t.$loaded().then(e)}function i(){s.cal=ics();var e=o.getJSDatetime(s.detail.startDate,s.detail.startTime),t=o.getJSDatetime(s.detail.endDate,s.detail.endTime);s.cal.addEvent(s.detail.title,s.detail.description,s.detail.location,e,t)}function u(e){s.detail=l.$getRecord(c),s.detail&&(s.detail.prettyDate=o.getPrettyDatetime(s.detail),s.detail.expired=o.expired(s.detail)),s.eventReady=!0}var s=this,c=n.eventId;s.data=r.data(),s.user=r.ref.getAuth(),s.showModal=!1,s.openRsvpModal=function(){s.showModal=!0},a(),t.$on("rsvpSubmitted",a),s.downloadIcs=function(){s.cal.download()};var l=r.events();l.$loaded(u);var d=e.$watch("event.rsvpReady",function(e,t){e&&s.detail&&s.detail.rsvp&&(i(),d())})}angular.module("myApp").controller("EventDetailCtrl",e),e.$inject=["$scope","$rootScope","$routeParams","Fire","Event"]}(),function(){"use strict";function e(e,t,n){function r(r){function o(){c=e.rsvps(),c.$loaded(function(){l.formModel=c.$getRecord(l.formModelId)})}function a(){var e=r.$watch("rf.formModel.attending",function(t,n){t!==!0||n||l.formModel.guests||(l.formModel.guests=1,e())})}function i(){l.btnSaved=!1,l.btnSubmitText=d?"Submit RSVP":"Update RSVP"}function u(){l.btnSaved=!0,l.btnSubmitText=d?"Submitted!":"Updated!",n.$broadcast("rsvpSubmitted"),d=!1,f=!0,a(),t(function(){i(),l.showModal=!1},1e3)}function s(e){l.btnSaved="error",l.btnSubmitText=d?"Error submitting!":"Error updating!",console.log(l.btnSubmitText,e),t(i,3e3)}var c,l=this,d=!!l.formModelId==!1,f=!!l.formModelId==!0;l.numberRegex=/^([1-9]|10)$/,d?(c=e.rsvps(),l.formModel={userId:l.userId,eventName:l.event.title,eventId:l.event.$id,name:l.userName}):f&&o(),a(),i(),n.$on("rsvpSubmitted",o),l.submitRsvp=function(){l.btnSubmitText="Sending...",l.formModel.attending||(l.formModel.guests=0),d?c.$add(l.formModel).then(u,s):f&&c.$save(l.formModel).then(u,s)},l.closeModal=function(){l.showModal=!1}}return r.$inject=["$scope"],{restrict:"EA",scope:{event:"=",userName:"@",userId:"@",formModelId:"@",showModal:"="},templateUrl:"/ng-app/event-detail/rsvpForm.tpl.html",controller:r,controllerAs:"rf",bindToController:!0}}angular.module("myApp").directive("rsvpForm",e),e.$inject=["Fire","$timeout","$rootScope"]}(),function(){"use strict";function e(e,t){function n(e){for(var n=0;n<r.allEvents.length;n++){var o=r.allEvents[n];o.startDateJS=t.getJSDatetime(o.startDate,o.startTime),o.expired=t.expired(o)}r.eventsReady=!0}var r=this;r.allEvents=e.events(),r.user=e.ref.getAuth(),r.allEvents.$loaded().then(n),r.sortStartDate=function(e){return t.getJSDatetime(e.startDate,e.startTime)}}angular.module("myApp").controller("EventsCtrl",e),e.$inject=["Fire","Event"]}(),function(){"use strict";function e(){return function(e){var t,n=new Date(e),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=r[n.getMonth()],a=n.getDate(),i=n.getFullYear();return t=o+" "+a+", "+i}}angular.module("myApp").filter("prettyDate",e)}(),function(){"use strict";function e(e,t,n,r){function o(e){i.localData=e}function a(t){i.user=t,t||e.path("/login")}var i=this,u=n.auth();t.getJSON().then(o),i.data=n.data(),i.user=n.ref.getAuth(),u.$onAuth(a),i.logout=function(){u.$unauth()},i.indexIsActive=function(t){return e.path()===t},i.navIsActive=function(t){return e.path().substr(0,t.length)===t}}angular.module("myApp").controller("HeaderCtrl",e),e.$inject=["$location","localData","Fire","$rootScope"]}(),function(){"use strict";function e(e,t,n){function r(r){function o(){c.removeClass("nav-closed").addClass("nav-open"),s=!0}function a(){c.removeClass("nav-open").addClass("nav-closed"),s=!1}function i(){a(),n(function(){r.nav.toggleNav=function(){s?a():o()}}),r.$on("$locationChangeSuccess",a)}function u(){n(function(){r.nav.toggleNav=null}),c.removeClass("nav-closed nav-open")}r.nav={};var s,c=angular.element("body");e.init({scope:r,mq:t.SMALL,enter:i,exit:u})}return r.$inject=["$scope","$element","$attrs"],{restrict:"EA",link:r}}angular.module("myApp").directive("navControl",e),e.$inject=["mediaCheck","MQ","$timeout"]}(),function(){"use strict";function e(e,t,n,r,o){function a(e){i.localData=e}var i=this,u=e.auth(),s=e.ref.getAuth();s&&r.path("/"),o.getJSON().then(a),i.logins=t.LOGINS,i.authenticate=function(e){function t(e){i.loggingIn=!1,r.path(n.authPath?n.authPath:"/")}i.loggingIn=!0,u.$authWithOAuthPopup(e).then(t)["catch"](function(e){console.log(e.data),i.loggingIn="error",i.loginMsg=""})}}angular.module("myApp").controller("LoginCtrl",e),e.$inject=["Fire","OAUTH","$rootScope","$location","localData"]}();